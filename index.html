
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Elegant Attire for Gentleman - Clothes Catalog</title>
    
    <!-- Google Fonts: Montserrat (Modern Elegant) for headings, Lato (Sans) for readability -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Lato', 'sans-serif'],
              display: ['Montserrat', 'sans-serif'],
            },
            colors: {
              'brand-primary': '#111111',   // Deep rich black
              'brand-secondary': '#fcfcfc', // Very clean off-white
              'brand-accent': '#9f855a',    // Muted gold/beige for luxury accent
              'brand-dark-grey': '#333333',
            }
          }
        }
      }
    </script>
    <style>
        body {
            font-family: 'Lato', sans-serif;
        }
        h1, h2, h3, h4, .font-display {
            font-family: 'Montserrat', sans-serif;
        }
        .form-container.hidden {
            max-height: 0;
            overflow: hidden;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            opacity: 0;
            transition: all 0.5s ease-in-out;
        }
        .form-container {
            max-height: 2000px;
            overflow: hidden;
            transition: all 0.5s ease-in-out;
            opacity: 1;
        }
        .fabric-swatch {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 1px solid #ddd;
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
            object-fit: cover;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95); /* Lighter, fashion-forward overlay */
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: transparent;
            padding: 40px;
            position: relative;
            display: flex;
            gap: 40px;
            max-width: 95vw;
            max-height: 90vh;
            align-items: center;
        }
        .modal-close {
            position: absolute;
            top: -20px;
            right: -20px;
            color: #111;
            font-size: 40px;
            font-weight: 300;
            cursor: pointer;
            line-height: 1;
            transition: transform 0.3s;
        }
        .modal-close:hover {
            transform: rotate(90deg);
        }
        .modal-image {
            max-width: 45vw;
            max-height: 85vh;
            object-fit: contain;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.1);
        }
        /* Custom scrollbar for webkit */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #ccc;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #999;
        }
    </style>
</head>
<body class="bg-brand-secondary text-brand-primary">
    
    <!-- Login View -->
    <div id="login-view" class="hidden">
        <div class="flex items-center justify-center min-h-screen bg-white">
            <div class="w-full max-w-md p-10 space-y-8 bg-white">
                <div class="text-center">
                    <h1 class="text-4xl font-display font-light text-brand-primary mb-2 uppercase tracking-wide">Admin Login</h1>
                    <p class="text-gray-500 font-light uppercase tracking-widest text-xs">Catalog Management</p>
                </div>
                <form id="login-form" class="space-y-8">
                    <div class="border-b border-gray-300 py-2">
                        <label for="password-input" class="sr-only">Password</label>
                        <input id="password-input" type="password" placeholder="Password" required class="w-full px-2 py-2 text-lg text-brand-primary placeholder-gray-400 bg-transparent focus:outline-none font-display" />
                    </div>
                    <p id="login-error" class="text-red-500 text-sm text-center font-light"></p>
                    <div>
                        <button type="submit" class="w-full px-4 py-4 text-xs font-bold uppercase tracking-widest text-white bg-brand-primary hover:bg-brand-accent transition duration-500 font-display">
                            Enter
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App View (Admin/Customer) -->
    <div id="app-view" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white sticky top-0 z-50 border-b border-gray-100/50 backdrop-blur-sm bg-white/90">
            <div class="container mx-auto px-6 py-6">
                <!-- Top utility bar -->
                <div class="flex justify-end items-center gap-6 mb-2 text-xs font-bold tracking-widest uppercase text-gray-500 font-display">
                     <a href="https://wa.me/526644995623" target="_blank" rel="noopener noreferrer" class="bg-[#25D366] hover:bg-[#128C7E] text-white px-4 py-2 rounded-full transition-colors flex items-center gap-2 shadow-sm">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                        <span>WhatsApp</span>
                    </a>
                    <button id="logout-button" class="hidden hover:text-brand-primary transition-colors">
                        Logout
                    </button>
                </div>
                
                <!-- Main Header Content -->
                <div class="flex flex-col md:flex-row justify-between items-center relative">
                    <!-- Logo centered visually on mobile, left on desktop usually but let's center it for fashion look -->
                    <div class="w-full text-center md:absolute md:left-1/2 md:transform md:-translate-x-1/2 md:-translate-y-1/2 md:top-1/2">
                        <h1 class="text-3xl md:text-4xl font-display font-medium text-brand-primary tracking-tight uppercase">Elegant Attire</h1>
                        <p class="text-[10px] uppercase tracking-[0.3em] text-gray-400 mt-1 font-display">For Gentleman</p>
                    </div>
                    
                    <!-- Search - visible desktop, moved down mobile -->
                     <div class="hidden md:block"></div> <!-- Spacer -->
                </div>
            </div>
        </header>

        <main class="container mx-auto px-6 py-12 flex-grow">
            <!-- Admin Panel -->
            <div id="admin-panel" class="bg-white border border-gray-200 p-8 mb-16 hidden shadow-sm">
                <div class="flex justify-between items-center flex-wrap gap-6 border-b border-gray-100 pb-6 mb-6">
                    <h2 class="text-2xl font-display font-light text-brand-primary uppercase tracking-wide">Admin Dashboard</h2>
                    <div class="flex flex-wrap gap-3">
                         <button id="download-db-button" class="px-6 py-2 text-xs font-bold uppercase tracking-widest text-white bg-blue-900 hover:bg-blue-800 transition duration-300 font-display">
                            Download DB
                        </button>
                        <button id="toggle-password-form-button" class="px-6 py-2 text-xs font-bold uppercase tracking-widest text-brand-primary border border-brand-primary hover:bg-brand-primary hover:text-white transition duration-300 font-display">
                            Password
                        </button>
                        <button id="toggle-form-button" class="px-6 py-2 text-xs font-bold uppercase tracking-widest text-white bg-brand-primary hover:bg-brand-accent transition duration-300 font-display">
                            Add Item
                        </button>
                    </div>
                </div>
                
                <div id="add-item-form-container" class="form-container hidden">
                    <h3 id="form-title" class="text-xl font-display mb-8 text-center uppercase tracking-wide">Manage Inventory</h3>
                    <form id="add-item-form" class="space-y-8 max-w-4xl mx-auto">
                        <input type="hidden" name="id" id="product-id-input">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-8">
                            <div class="space-y-8">
                                <div class="border-b border-gray-300">
                                    <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-display">Product Name</label>
                                    <input name="name" type="text" class="w-full py-2 bg-transparent focus:outline-none font-display text-lg" required />
                                </div>
                                <div class="border-b border-gray-300">
                                    <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-display">Brand</label>
                                    <input name="brand" type="text" class="w-full py-2 bg-transparent focus:outline-none font-display text-lg" required />
                                </div>
                                <div class="border-b border-gray-300">
                                    <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-display">Category</label>
                                    <select name="category" class="w-full py-2 bg-transparent focus:outline-none font-display text-lg" required>
                                        <!-- Options will be populated by JS -->
                                    </select>
                                </div>
                                <div class="border-b border-gray-300">
                                    <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-display">Fabric Name</label>
                                    <input name="fabric" type="text" class="w-full py-2 bg-transparent focus:outline-none font-display text-lg" required />
                                </div>
                            </div>
                            <div class="space-y-8">
                                <div class="border-b border-gray-300">
                                    <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-display">Fabric Image URL</label>
                                    <input name="fabricImageUrl" type="url" class="w-full py-2 bg-transparent focus:outline-none font-display text-lg text-gray-600" required />
                                </div>
                                <div class="border-b border-gray-300">
                                    <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-display">Product Image URL</label>
                                    <input name="imageUrl" type="url" class="w-full py-2 bg-transparent focus:outline-none font-display text-lg text-gray-600" required />
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                     <div class="border-b border-gray-300">
                                        <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-display">Size</label>
                                        <input name="size" type="text" class="w-full py-2 bg-transparent focus:outline-none font-display text-lg" required />
                                    </div>
                                    <div class="border-b border-gray-300">
                                        <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-display">Quantity</label>
                                        <input name="quantity" type="number" min="0" class="w-full py-2 bg-transparent focus:outline-none font-display text-lg" required />
                                    </div>
                                </div>
                                <div class="border-b border-gray-300">
                                    <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-display">Color</label>
                                    <input name="color" type="text" class="w-full py-2 bg-transparent focus:outline-none font-display text-lg" required />
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between items-center pt-8">
                             <div>
                                <button id="delete-item-button" type="button" class="hidden px-6 py-2 text-xs font-bold uppercase tracking-widest text-red-600 hover:text-red-800 transition duration-300 font-display">
                                    Delete
                                </button>
                            </div>
                            <div class="flex gap-4">
                                <button id="cancel-edit-button" type="button" class="hidden px-6 py-2 text-xs font-bold uppercase tracking-widest text-gray-500 hover:text-gray-900 transition duration-300 font-display">
                                    Cancel
                                </button>
                                <button id="form-submit-button" type="submit" class="px-8 py-3 text-xs font-bold uppercase tracking-widest text-white bg-green-700 hover:bg-green-800 transition duration-300 shadow-lg font-display">
                                    Save Product
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <div id="change-password-form-container" class="form-container hidden mt-6 border-t border-gray-100 pt-6">
                    <form id="change-password-form" class="space-y-4 max-w-md mx-auto">
                        <div class="border-b border-gray-300">
                            <input name="currentPassword" type="password" placeholder="Current Password" class="w-full py-2 bg-transparent focus:outline-none" required />
                        </div>
                        <div class="border-b border-gray-300">
                            <input name="newPassword" type="password" placeholder="New Password" class="w-full py-2 bg-transparent focus:outline-none" required />
                        </div>
                        <div class="border-b border-gray-300">
                            <input name="confirmPassword" type="password" placeholder="Confirm Password" class="w-full py-2 bg-transparent focus:outline-none" required />
                        </div>
                        <p id="password-change-message" class="text-xs h-5 text-center"></p>
                        <div class="flex justify-end">
                            <button type="submit" class="px-6 py-2 text-xs font-bold uppercase tracking-widest text-white bg-brand-primary hover:bg-brand-accent transition duration-300 font-display">
                                Update
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Admin Inventory Table -->
                <div id="admin-inventory-section" class="hidden mt-12 border-t border-gray-100 pt-8">
                    <h3 class="text-xl font-display mb-6 text-brand-primary uppercase tracking-wide">Current Collection</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-100">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-widest text-gray-500 font-display">No.</th>
                                    <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-widest text-gray-500 font-display">Item</th>
                                    <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-widest text-gray-500 font-display">Category</th>
                                    <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-widest text-gray-500 font-display">Brand</th>
                                    <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-widest text-gray-500 font-display">Qty</th>
                                    <th class="px-6 py-3 text-right text-xs font-bold uppercase tracking-widest text-gray-500 font-display">Edit</th>
                                </tr>
                            </thead>
                            <tbody id="admin-inventory-body" class="bg-white divide-y divide-gray-50">
                                <!-- Rows will be populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                 <div id="admin-instructions" class="hidden mt-6 text-xs text-gray-500 bg-gray-50 p-6">
                    <p class="font-bold uppercase tracking-wider mb-2 font-display">Persistence Workflow</p>
                    <ol class="list-decimal list-inside space-y-1 font-light">
                        <li>Modify collection in browser.</li>
                        <li>Download <code class="bg-gray-200 px-1">products.json</code>.</li>
                        <li>Copy the content of the downloaded file.</li>
                        <li>Replace the <code class="bg-gray-200 px-1">initialProducts</code> array in <code class="bg-gray-200 px-1">index.html</code>.</li>
                        <li>Commit the changes.</li>
                    </ol>
                </div>

            </div>

            <!-- Customer View -->
            <div class="mt-4">
                <!-- Search Bar -->
                <div class="mb-16 max-w-lg mx-auto relative group">
                    <input id="search-input" type="search" placeholder="Search the collection..." class="w-full bg-transparent border-b border-gray-300 px-4 py-3 text-xl font-display text-brand-primary placeholder-gray-400 focus:outline-none focus:border-brand-primary transition-colors text-center group-hover:border-gray-400">
                    <div class="absolute inset-x-0 bottom-0 h-[1px] bg-brand-primary transform scale-x-0 transition-transform duration-500 group-hover:scale-x-50 focus-within:scale-x-100 origin-center"></div>
                </div>

                <div class="flex flex-col md:flex-row gap-12">
                    <!-- Category Filter (Sidebar) -->
                    <aside class="w-full md:w-1/5 lg:w-1/6">
                        <div id="category-filter-container" class="sticky top-32">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6 border-b border-gray-100 pb-2 font-display">Categories</h3>
                            <ul id="category-list" class="space-y-1">
                                <!-- Categories will be populated by JS -->
                            </ul>
                        </div>
                    </aside>
                    <!-- Product Grid -->
                    <section class="w-full md:w-4/5 lg:w-5/6">
                        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-x-8 gap-y-16">
                            <!-- Products will be populated by JS -->
                        </div>
                    </section>
                </div>
            </div>
        </main>

        <!-- Image Modal -->
        <div id="image-modal" class="modal-overlay">
            <div class="modal-content">
                <span id="modal-close-button" class="modal-close">&times;</span>
                <div class="flex flex-col md:flex-row gap-12 items-center">
                    <div class="modal-image-container relative">
                        <img id="modal-product-image" src="" alt="Product" class="modal-image shadow-2xl">
                    </div>
                    <div class="modal-image-container flex flex-col justify-center max-w-xs">
                        <h4 id="modal-product-title" class="text-3xl font-display font-medium mb-4 text-brand-primary uppercase tracking-tight"></h4>
                        <div class="w-12 h-0.5 bg-brand-accent mb-6"></div>
                        <div class="mb-8">
                             <img id="modal-fabric-image" src="" alt="Fabric" class="w-24 h-24 object-cover border border-gray-200 rounded-full mb-2">
                             <p class="text-xs uppercase tracking-widest text-gray-500 font-display">Fabric Detail</p>
                        </div>
                        <p class="text-gray-600 font-light leading-relaxed mb-4">
                            Crafted with precision, this piece exemplifies modern elegance. Perfect for the gentleman who appreciates detail.
                        </p>
                         <p id="modal-product-qty" class="text-sm font-bold text-brand-primary mt-2 font-display"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-white border-t border-gray-100 mt-24">
            <div class="container mx-auto px-6 py-12 text-center">
                <h3 class="text-2xl font-display font-light mb-6 text-brand-primary uppercase tracking-wide">Personal Concierge</h3>
                <p class="text-gray-500 font-light mb-8 max-w-md mx-auto">Our assistant is available to assist with sizing, fabric selection, and pairing advice.</p>
                <a href="https://wa.me/526644995623" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-3 px-8 py-3 text-xs font-bold uppercase tracking-widest text-white bg-[#25D366] hover:bg-[#128C7E] transition duration-500 font-display shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12c0 1.62.4 3.16 1.12 4.52L2 22l5.48-1.12C8.84 21.6 10.38 22 12 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm0 18c-1.4 0-2.76-.36-3.95-1.01l-.28-.17-2.94.61.62-2.88-.19-.29C4.6 14.76 4 13.4 4 12c0-4.41 3.59-8 8-8s8 3.59 8 8-3.59 8-8 8zm4.35-6.09c-.19-.1-.43-.19-.62-.29-.19-.1-.43-.19-1.02-.48s-.59-.28-1.02-.48c-.43-.19-.71-.28-.85-.14-.14.14-.38.43-.48.59s-.19.19-.38.19c-.19 0-.43-.1-.59-.19s-.71-.28-1.34-.85c-.62-.59-1.04-1.22-1.18-1.42s-.14-.33-.05-.48c.09-.14.19-.23.28-.33s.14-.19.23-.28c.09-.1.14-.19.23-.33s.05-.19-.05-.38c-.09-.19-.85-2.04-1.18-2.76s-.66-.62-.9-.62c-.23 0-.48 0-.66.05-.19.05-.43.19-.66.43s-.85.85-1.04 2.04c-.19 1.18.23 2.32.48 2.56.23.23.85 1.34 2.04 2.32s2.04 1.64 2.32 1.78c.28.14.54.12.73.07.23-.05.71-.28.85-.54s.14-.54.1-.73c-.05-.19-.19-.28-.38-.38z"/></svg>
                    WhatsApp Support
                </a>
                <p class="mt-12 text-[10px] uppercase tracking-widest text-gray-400 font-display">&copy; 2023 Elegant Attire for Gentleman.</p>
            </div>
        </footer>
    </div>


    <script>
    // --- APP INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        
        // --- DATA & STATE ---
        const PASSWORD_STORAGE_KEY = 'elegant_attire_admin_password';
        const DEFAULT_PASSWORD = 'password123';

        const Category = {
            SuitJackets: 'Suit Jackets',
            Pants: 'Pants',
            Shirts: 'Shirts',
            Ties: 'Ties',
            Shoes: 'Shoes',
        };
        
        const initialProducts = [
          {
            "id": 1,
            "uniqueNumber": 1,
            "name": "Classic Navy Blazer",
            "brand": "Prestige Wear",
            "category": "Suit Jackets",
            "size": "40R",
            "color": "Navy",
            "fabric": "Wool",
            "quantity": 5,
            "imageUrl": "https://picsum.photos/seed/jacket1/600/800",
            "fabricImageUrl": "https://picsum.photos/seed/wool/50/50"
          },
          {
            "id": 2,
            "uniqueNumber": 2,
            "name": "Slim Fit Chinos",
            "brand": "Urban Threads",
            "category": "Pants",
            "size": "32x32",
            "color": "Khaki",
            "fabric": "Cotton Twill",
            "quantity": 12,
            "imageUrl": "https://picsum.photos/seed/pants1/600/800",
            "fabricImageUrl": "https://picsum.photos/seed/twill/50/50"
          },
          {
            "id": 3,
            "uniqueNumber": 3,
            "name": "Oxford Button-Down",
            "brand": "Gentleman's Choice",
            "category": "Shirts",
            "size": "M",
            "color": "White",
            "fabric": "Oxford Cotton",
            "quantity": 8,
            "imageUrl": "https://picsum.photos/seed/shirt1/600/800",
            "fabricImageUrl": "https://picsum.photos/seed/oxford/50/50"
          },
          {
            "id": 4,
            "uniqueNumber": 4,
            "name": "Leather Wingtip Oxfords",
            "brand": "Walk London",
            "category": "Shoes",
            "size": "10",
            "color": "Brown",
            "fabric": "Full-grain Leather",
            "quantity": 3,
            "imageUrl": "https://picsum.photos/seed/shoes1/600/800",
            "fabricImageUrl": "https://picsum.photos/seed/leather/50/50"
          },
          {
            "id": 5,
            "uniqueNumber": 5,
            "name": "Silk Striped Tie",
            "brand": "Luxe Loom",
            "category": "Ties",
            "size": "One Size",
            "color": "Red/Blue Stripe",
            "fabric": "Silk",
            "quantity": 15,
            "imageUrl": "https://picsum.photos/seed/tie1/600/800",
            "fabricImageUrl": "https://picsum.photos/seed/silk/50/50"
          },
          {
            "id": 6,
            "uniqueNumber": 6,
            "name": "Tweed Sport Coat",
            "brand": "Country Squire",
            "category": "Suit Jackets",
            "size": "42R",
            "color": "Brown Herringbone",
            "fabric": "Wool Tweed",
            "quantity": 2,
            "imageUrl": "https://picsum.photos/seed/jacket2/600/800",
            "fabricImageUrl": "https://picsum.photos/seed/tweed/50/50"
          },
          {
            "id": 7,
            "uniqueNumber": 7,
            "name": "Wool Flannel Trousers",
            "brand": "Prestige Wear",
            "category": "Pants",
            "size": "34x32",
            "color": "Grey",
            "fabric": "Wool Flannel",
            "quantity": 6,
            "imageUrl": "https://picsum.photos/seed/pants2/600/800",
            "fabricImageUrl": "https://picsum.photos/seed/flannel/50/50"
          },
          {
            "id": 8,
            "uniqueNumber": 8,
            "name": "Linen Casual Shirt",
            "brand": "Urban Threads",
            "category": "Shirts",
            "size": "L",
            "color": "Natural",
            "fabric": "Linen",
            "quantity": 10,
            "imageUrl": "https://picsum.photos/seed/shirt2/600/800",
            "fabricImageUrl": "https://picsum.photos/seed/linen/50/50"
          }
        ];

        // Use a let binding for products so we can reassign it with immutable updates
        let products = initialProducts.map(p => ({ ...p, quantity: p.quantity !== undefined ? p.quantity : 1 }));
        
        let isLoggedIn = false;
        let selectedCategory = 'All';
        let editingProductId = null;
        let searchTerm = '';

        // --- DOM ELEMENTS ---
        const loginView = document.getElementById('login-view');
        const appView = document.getElementById('app-view');
        const adminPanel = document.getElementById('admin-panel');
        const loginForm = document.getElementById('login-form');
        const passwordInput = document.getElementById('password-input');
        const loginError = document.getElementById('login-error');
        const logoutButton = document.getElementById('logout-button');
        const productGrid = document.getElementById('product-grid');
        const categoryList = document.getElementById('category-list');
        const toggleFormButton = document.getElementById('toggle-form-button');
        const addItemFormContainer = document.getElementById('add-item-form-container');
        const addItemForm = document.getElementById('add-item-form');
        const categorySelect = document.querySelector('select[name="category"]');
        const formTitle = document.getElementById('form-title');
        const formSubmitButton = document.getElementById('form-submit-button');
        const productIdInput = document.getElementById('product-id-input');
        const cancelEditButton = document.getElementById('cancel-edit-button');
        const deleteItemButton = document.getElementById('delete-item-button');
        const togglePasswordFormButton = document.getElementById('toggle-password-form-button');
        const changePasswordFormContainer = document.getElementById('change-password-form-container');
        const changePasswordForm = document.getElementById('change-password-form');
        const passwordChangeMessage = document.getElementById('password-change-message');
        const searchInput = document.getElementById('search-input');
        const adminInventorySection = document.getElementById('admin-inventory-section');
        const adminInventoryBody = document.getElementById('admin-inventory-body');
        const imageModal = document.getElementById('image-modal');
        const modalCloseButton = document.getElementById('modal-close-button');
        const modalProductImage = document.getElementById('modal-product-image');
        const modalFabricImage = document.getElementById('modal-fabric-image');
        const modalProductTitle = document.getElementById('modal-product-title');
        const modalProductQty = document.getElementById('modal-product-qty');
        const downloadDbButton = document.getElementById('download-db-button');
        const adminInstructions = document.getElementById('admin-instructions');

        const initializePassword = () => {
            if (!localStorage.getItem(PASSWORD_STORAGE_KEY)) {
                localStorage.setItem(PASSWORD_STORAGE_KEY, DEFAULT_PASSWORD);
            }
        };

        // --- HELPER FUNCTIONS ---
        const getNextUniqueNumber = (currentProducts) => {
            const existingNumbers = new Set(currentProducts.map(p => p.uniqueNumber).filter(n => typeof n === 'number'));
            let candidate = 1;
            while (existingNumbers.has(candidate)) {
                candidate++;
            }
            return candidate;
        };

        // --- RENDER FUNCTIONS (UI LOGIC) ---
        const updateUI = () => {
            if (isLoggedIn) {
                loginView.classList.add('hidden');
                appView.classList.remove('hidden');
                adminPanel.classList.remove('hidden');
                adminInventorySection.classList.remove('hidden');
                adminInstructions.classList.remove('hidden');
                logoutButton.classList.remove('hidden');
            } else {
                appView.classList.remove('hidden');
                loginView.classList.add('hidden');
                adminPanel.classList.add('hidden');
                adminInventorySection.classList.add('hidden');
                adminInstructions.classList.add('hidden');
                logoutButton.classList.add('hidden');
            }
            renderCategories();
            renderCustomerGrid();
            if (isLoggedIn) {
                renderAdminTable();
            }
        };

        const renderCustomerGrid = () => {
            productGrid.innerHTML = '';
            const categoryFilteredProducts = selectedCategory === 'All' ? products : products.filter(p => p.category === selectedCategory);
            const finalFilteredProducts = searchTerm.trim() === '' ? categoryFilteredProducts : categoryFilteredProducts.filter(p =>
                p.name.toLowerCase().includes(searchTerm) ||
                (p.uniqueNumber && p.uniqueNumber.toString().includes(searchTerm)) ||
                p.brand.toLowerCase().includes(searchTerm) ||
                p.fabric.toLowerCase().includes(searchTerm) ||
                p.color.toLowerCase().includes(searchTerm)
            );
            if (finalFilteredProducts.length === 0) {
                productGrid.innerHTML = `<div class="col-span-full text-center py-20 text-gray-400 font-light tracking-wide uppercase text-sm font-display">No pieces found matching your criteria.</div>`;
            } else {
                finalFilteredProducts.forEach(product => {
                    const uniqueNumDisplay = product.uniqueNumber ? `<div class="absolute top-0 left-0 bg-brand-primary text-white text-sm font-bold font-display px-3 py-2 z-10 shadow-lg border-r border-b border-gray-100">#${product.uniqueNumber}</div>` : '';
                    
                    const productCardHTML = `
                        <div class="group cursor-pointer" data-id="${product.id}">
                            <div class="relative overflow-hidden aspect-[3/4] mb-5 bg-gray-50">
                                ${uniqueNumDisplay}
                                <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-full object-cover transition-transform duration-[800ms] group-hover:scale-105" />
                                
                                <!-- Hover Overlay for details -->
                                <div class="absolute inset-0 bg-black/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                
                                <div class="absolute bottom-0 left-0 right-0 p-5 translate-y-full group-hover:translate-y-0 transition-transform duration-500 bg-white/95 backdrop-blur-sm border-t border-gray-100">
                                     <div class="flex items-center justify-between text-xs text-gray-600 font-light tracking-wide">
                                        <div class="flex flex-col">
                                            <span class="uppercase text-[9px] text-gray-400 mb-1 font-display">Size</span>
                                            <span>${product.size}</span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <span class="uppercase text-[9px] text-gray-400 mb-1 font-display">In Stock</span>
                                            <span>${product.quantity}</span>
                                        </div>
                                        <div class="flex flex-col items-end">
                                            <span class="uppercase text-[9px] text-gray-400 mb-1 font-display">Fabric</span>
                                            <div class="flex items-center gap-2">
                                                <span>${product.fabric}</span>
                                                <img src="${product.fabricImageUrl}" class="w-4 h-4 rounded-full border border-gray-300" title="${product.fabric}">
                                            </div>
                                        </div>
                                     </div>
                                </div>
                            </div>
                            
                            <div class="text-center px-2">
                                <h4 class="text-[10px] font-bold tracking-[0.2em] text-gray-400 uppercase mb-2 group-hover:text-brand-accent transition-colors font-display">${product.brand}</h4>
                                <h3 class="text-xl font-display font-medium text-brand-primary leading-tight mb-2 uppercase tracking-wide">${product.name}</h3>
                                <p class="text-xs text-gray-500 font-light">${product.color}</p>
                            </div>
                        </div>`;
                    productGrid.insertAdjacentHTML('beforeend', productCardHTML);
                });
            }
        };

        const renderAdminTable = () => {
            adminInventoryBody.innerHTML = '';
            const filteredForAdmin = searchTerm.trim() === '' ? products : products.filter(p =>
                p.name.toLowerCase().includes(searchTerm) ||
                (p.uniqueNumber && p.uniqueNumber.toString().includes(searchTerm)) ||
                p.brand.toLowerCase().includes(searchTerm) ||
                p.fabric.toLowerCase().includes(searchTerm) ||
                p.color.toLowerCase().includes(searchTerm)
            );
            if (filteredForAdmin.length === 0) {
                adminInventoryBody.innerHTML = `<tr><td colspan="6" class="px-6 py-6 text-center text-sm text-gray-400 font-light font-display">Inventory empty.</td></tr>`;
                return;
            }
            filteredForAdmin.forEach(product => {
                const uniqueNum = product.uniqueNumber ? `#${product.uniqueNumber}` : '-';
                const rowHTML = `
                    <tr class="hover:bg-gray-50 transition-colors group">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-brand-primary font-bold font-display">${uniqueNum}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="h-12 w-12 flex-shrink-0 overflow-hidden bg-gray-100">
                                    <img class="h-full w-full object-cover group-hover:scale-110 transition-transform duration-500" src="${product.imageUrl}" alt="${product.name}">
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-display font-medium text-gray-900 uppercase tracking-wide">${product.name}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap"><div class="text-xs uppercase tracking-wider text-gray-500 font-display">${product.category}</div></td>
                        <td class="px-6 py-4 whitespace-nowrap"><span class="text-sm text-gray-900 font-light">${product.brand}</span></td>
                        <td class="px-6 py-4 whitespace-nowrap"><span class="text-sm text-gray-900 font-bold font-display">${product.quantity}</span></td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                            <button data-id="${product.id}" class="admin-edit-btn text-brand-primary hover:text-brand-accent transition-colors" title="Edit">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                            </button>
                            <button data-id="${product.id}" class="admin-delete-btn text-gray-300 hover:text-red-500 transition-colors" title="Delete">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            </button>
                        </td>
                    </tr>`;
                adminInventoryBody.insertAdjacentHTML('beforeend', rowHTML);
            });
        };

        const renderCategories = () => {
            categoryList.innerHTML = '';
            const categories = ['All', ...Object.values(Category)];
            categories.forEach(category => {
                const li = document.createElement('li');
                const button = document.createElement('button');
                const isActive = selectedCategory === category;
                button.textContent = category;
                button.className = `w-full text-left py-2 text-sm uppercase tracking-widest transition-all duration-300 font-display ${isActive ? 'text-brand-primary font-bold border-l-2 border-brand-accent pl-4' : 'text-gray-400 hover:text-brand-primary font-light border-l-2 border-transparent pl-4 hover:border-gray-200'}`;
                button.addEventListener('click', () => {
                    selectedCategory = category;
                    updateUI();
                });
                li.appendChild(button);
                categoryList.appendChild(li);
            });
        };

        const populateCategorySelect = () => {
            categorySelect.innerHTML = '';
            Object.values(Category).forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
            });
        };

        // --- DATA HANDLING (STATE LOGIC) ---
        const resetForm = () => {
            addItemForm.reset();
            editingProductId = null;
            productIdInput.value = '';
            formTitle.textContent = 'Add To Collection';
            formSubmitButton.textContent = 'Save Product';
            cancelEditButton.classList.add('hidden');
            deleteItemButton.classList.add('hidden');
        };

        const startEditing = (productId) => {
            const productToEdit = products.find(p => p.id === productId);
            if (!productToEdit) return;
            editingProductId = productId;
            productIdInput.value = productToEdit.id;
            const form = addItemForm;
            form.elements['name'].value = productToEdit.name;
            form.elements['brand'].value = productToEdit.brand;
            form.elements['category'].value = productToEdit.category;
            form.elements['fabric'].value = productToEdit.fabric;
            form.elements['fabricImageUrl'].value = productToEdit.fabricImageUrl;
            form.elements['imageUrl'].value = productToEdit.imageUrl;
            form.elements['size'].value = productToEdit.size;
            form.elements['color'].value = productToEdit.color;
            form.elements['quantity'].value = productToEdit.quantity || 1;
            formTitle.textContent = 'Edit Collection Piece';
            formSubmitButton.textContent = 'Update';
            cancelEditButton.classList.remove('hidden');
            deleteItemButton.classList.remove('hidden');
            toggleFormButton.textContent = 'Close Editor';
            addItemFormContainer.classList.remove('hidden');
            addItemFormContainer.scrollIntoView({ behavior: 'smooth' });
        };

        const handleDelete = (productId) => {
            const numericId = parseInt(productId, 10);
            const productToDelete = products.find(p => p.id === numericId);
            if (!productToDelete) return;
            if (window.confirm(`Delete "${productToDelete.name}" from the collection?`)) {
                products = products.filter(p => p.id !== numericId);
                if (editingProductId === numericId) {
                    handleToggleForm();
                }
                updateUI();
            }
        };
        
        const handleDownloadDatabase = () => {
            const dataStr = JSON.stringify(products, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'products.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        };

        // --- EVENT HANDLERS ---
        const handleShowLogin = () => {
            appView.classList.add('hidden');
            loginView.classList.remove('hidden');
        };

        const handleLogin = (e) => {
            e.preventDefault();
            const storedPassword = localStorage.getItem(PASSWORD_STORAGE_KEY);
            if (passwordInput.value === storedPassword) {
                isLoggedIn = true;
                passwordInput.value = '';
                loginError.textContent = '';
                populateCategorySelect();
                updateUI();
            } else {
                loginError.textContent = 'Incorrect password.';
                passwordInput.value = '';
            }
        };

        const handleLogout = () => {
            isLoggedIn = false;
            if (!addItemFormContainer.classList.contains('hidden')) handleToggleForm();
            if (!changePasswordFormContainer.classList.contains('hidden')) handleTogglePasswordForm();
            updateUI();
        };

        const handleToggleForm = () => {
            if (!changePasswordFormContainer.classList.contains('hidden')) handleTogglePasswordForm();
            const isHidden = addItemFormContainer.classList.contains('hidden');
            if (!isHidden) resetForm();
            addItemFormContainer.classList.toggle('hidden');
            toggleFormButton.textContent = isHidden ? 'Close' : 'Add Item';
        };

        const handleTogglePasswordForm = () => {
            if (!addItemFormContainer.classList.contains('hidden')) handleToggleForm();
            const isHidden = changePasswordFormContainer.classList.contains('hidden');
            if (!isHidden) {
                changePasswordForm.reset();
                passwordChangeMessage.textContent = '';
                passwordChangeMessage.className = 'text-xs h-5 text-center';
            }
            changePasswordFormContainer.classList.toggle('hidden');
            togglePasswordFormButton.textContent = isHidden ? 'Close' : 'Password';
        };

        const handleFormSubmit = (e) => {
            e.preventDefault();
            const formData = new FormData(addItemForm);
            const productData = {
                name: formData.get('name').toString(),
                brand: formData.get('brand').toString(),
                category: formData.get('category').toString(),
                size: formData.get('size').toString(),
                color: formData.get('color').toString(),
                fabric: formData.get('fabric').toString(),
                imageUrl: formData.get('imageUrl').toString(),
                fabricImageUrl: formData.get('fabricImageUrl').toString(),
                quantity: parseInt(formData.get('quantity').toString(), 10) || 1,
            };
            
            if (editingProductId) {
                products = products.map(p => p.id === editingProductId ? { ...p, ...productData, uniqueNumber: p.uniqueNumber } : p);
            } else {
                const uniqueNumber = getNextUniqueNumber(products);
                const newProduct = { id: Date.now(), uniqueNumber, ...productData };
                products = [newProduct, ...products];
            }
            
            resetForm();
            addItemFormContainer.classList.add('hidden');
            toggleFormButton.textContent = 'Add Item';
            updateUI();
        };

        const handleChangePassword = (e) => {
            e.preventDefault();
            passwordChangeMessage.textContent = '';
            passwordChangeMessage.className = 'text-xs h-5 text-center';
            const formData = new FormData(changePasswordForm);
            const currentPassword = formData.get('currentPassword').toString();
            const newPassword = formData.get('newPassword').toString();
            const confirmPassword = formData.get('confirmPassword').toString();
            const storedPassword = localStorage.getItem(PASSWORD_STORAGE_KEY);
            if (currentPassword !== storedPassword) {
                passwordChangeMessage.textContent = 'Incorrect current password.';
                passwordChangeMessage.classList.add('text-red-500');
                return;
            }
            if (!newPassword || newPassword.length < 6) {
                passwordChangeMessage.textContent = 'Password must be 6+ chars.';
                passwordChangeMessage.classList.add('text-red-500');
                return;
            }
            if (newPassword !== confirmPassword) {
                passwordChangeMessage.textContent = 'Passwords do not match.';
                passwordChangeMessage.classList.add('text-red-500');
                return;
            }
            localStorage.setItem(PASSWORD_STORAGE_KEY, newPassword);
            passwordChangeMessage.textContent = 'Password updated.';
            passwordChangeMessage.classList.add('text-green-600');
            setTimeout(() => { handleTogglePasswordForm(); }, 2000);
        };

        const handleSearch = (e) => {
            searchTerm = e.target.value.toLowerCase();
            updateUI();
        };

        const openImageModal = (productId) => {
            const product = products.find(p => p.id === productId);
            if (product) {
                modalProductImage.src = product.imageUrl;
                modalFabricImage.src = product.fabricImageUrl;
                const uniqueNumText = product.uniqueNumber ? ` #${product.uniqueNumber}` : '';
                modalProductTitle.textContent = `${product.name}`;
                modalProductQty.textContent = `Available Quantity: ${product.quantity}`;
                imageModal.classList.add('visible');
            }
        };

        const closeImageModal = () => { imageModal.classList.remove('visible'); };
        const handleAdminShortcut = (e) => { if (e.key === 'A' && e.shiftKey && (e.ctrlKey || e.metaKey)) { e.preventDefault(); if (!isLoggedIn) handleShowLogin(); } };

        // --- INITIALIZATION & EVENT LISTENERS ---
        initializePassword();
        
        loginForm.addEventListener('submit', handleLogin);
        logoutButton.addEventListener('click', handleLogout);
        toggleFormButton.addEventListener('click', handleToggleForm);
        addItemForm.addEventListener('submit', handleFormSubmit);
        cancelEditButton.addEventListener('click', handleToggleForm);
        deleteItemButton.addEventListener('click', () => handleDelete(editingProductId));
        togglePasswordFormButton.addEventListener('click', handleTogglePasswordForm);
        changePasswordForm.addEventListener('submit', handleChangePassword);
        searchInput.addEventListener('input', handleSearch);
        downloadDbButton.addEventListener('click', handleDownloadDatabase);
        document.addEventListener('keydown', handleAdminShortcut);

        adminInventoryBody.addEventListener('click', (e) => {
            const target = e.target;
            const editBtn = target.closest('.admin-edit-btn');
            if (editBtn) { const id = parseInt(editBtn.dataset.id, 10); startEditing(id); return; }
            const deleteBtn = target.closest('.admin-delete-btn');
            if (deleteBtn) { const id = parseInt(deleteBtn.dataset.id, 10); handleDelete(id); }
        });
        productGrid.addEventListener('click', (e) => {
            const card = e.target.closest('.group');
            if (card) { const id = parseInt(card.dataset.id, 10); openImageModal(id); }
        });
        modalCloseButton.addEventListener('click', closeImageModal);
        imageModal.addEventListener('click', (e) => { if (e.target === imageModal) closeImageModal(); });

        updateUI(); // Initial render of the application
    });
    </script>
</body>
</html>
